---
title: "Next.js 빌드 에러 완벽 해결 가이드"
description: "Next.js 프로젝트에서 자주 발생하는 빌드 에러와 해결 방법을 실제 사례와 함께 정리했습니다."
date: "2025-01-20"
tags: ["Next.js", "Troubleshooting", "Build Errors", "MDX"]
category: "Troubleshooting"
author: "Claude Code"
status: "draft"
featured: false
---

# Next.js 빌드 에러 완벽 해결 가이드

## 문제 개요

Next.js 프로젝트에서 `pnpm build` 또는 `npm run build` 실행 시 다양한 에러가 발생할 수 있습니다. 이 가이드에서는 가장 흔한 빌드 에러와 해결 방법을 다룹니다.

---

## 빠른 해결 방법 (Quick Fix)

### 방법 1: 캐시 삭제 및 재설치 (70%)

```bash
# Next.js 캐시 삭제
rm -rf .next

# node_modules 재설치
rm -rf node_modules package-lock.json
npm install
```

### 방법 2: TypeScript 재검사 (20%)

```bash
# TypeScript 캐시 삭제
rm -rf tsconfig.tsbuildinfo

# 타입 체크
npx tsc --noEmit
```

### 방법 3: 환경 변수 확인 (10%)

```bash
# .env 파일 확인
cat .env.local
```

---

## 에러 1: MDX 관련 타입 에러

### 증상

```
Failed to compile.

./app/page.tsx:135:44
Type error: Type '{ mdxOptions: { ... } }' is not assignable to type 'SerializeOptions'
```

### 발생 환경

- Next.js 15.x
- next-mdx-remote 5.x
- TypeScript 5.x

### 원인

`next-mdx-remote`의 `SerializeOptions` 타입과 rehype 플러그인 타입이 호환되지 않는 문제입니다.

### 해결 방법

**Step 1**: ESLint 주석으로 타입 단언 허용

```typescript
// Before - 에러 발생
import { MDXRemote } from 'next-mdx-remote/rsc';

const options = {
  mdxOptions: {
    rehypePlugins: [
      rehypeHighlight,
      rehypeSlug,
      [rehypeAutolinkHeadings, { behavior: 'wrap' }]
    ]
  }
};

<MDXRemote source={content} options={options} />
```

```typescript
// After - 해결
import { MDXRemote } from 'next-mdx-remote/rsc';

const options = {
  mdxOptions: {
    rehypePlugins: [
      rehypeHighlight,
      rehypeSlug,
      [rehypeAutolinkHeadings, { behavior: 'wrap' }]
    ]
  }
};

{/* eslint-disable-next-line @typescript-eslint/no-explicit-any */}
<MDXRemote source={content} options={options as any} />
```

**Step 2**: 다른 파일에도 동일하게 적용

```typescript
// lib/mdx.ts
export async function compileMDXContent(source: string) {
  const { content, frontmatter } = await compileMDX<PostFrontmatter>({
    source,
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    options: mdxOptions as any,
  });

  return { content, frontmatter };
}
```

### 예방 방법

```json
// package.json에 정확한 버전 명시
{
  "dependencies": {
    "next-mdx-remote": "5.0.0",
    "rehype-highlight": "7.0.2",
    "rehype-slug": "6.0.0"
  }
}
```

---

## 에러 2: Hydration Mismatch

### 증상

```
Error: Hydration failed because the initial UI does not match what was rendered on the server.
```

### 발생 원인

서버에서 렌더링된 HTML과 클라이언트에서 렌더링된 HTML이 다를 때 발생합니다.

### 원인 1: 날짜/시간 사용

**문제 코드**:
```typescript
function Component() {
  return <div>{new Date().toString()}</div>;
}
```

**해결**:
```typescript
'use client';

function Component() {
  const [date, setDate] = useState('');

  useEffect(() => {
    setDate(new Date().toString());
  }, []);

  return <div>{date || 'Loading...'}</div>;
}
```

### 원인 2: localStorage 사용

**문제 코드**:
```typescript
function Component() {
  const theme = localStorage.getItem('theme');
  return <div className={theme}>Content</div>;
}
```

**해결**:
```typescript
'use client';

function Component() {
  const [theme, setTheme] = useState('light');

  useEffect(() => {
    setTheme(localStorage.getItem('theme') || 'light');
  }, []);

  return <div className={theme}>Content</div>;
}
```

### 원인 3: HTML 구조 불일치

**문제 코드**:
```typescript
function List() {
  return (
    <ul>
      {items.map(item => (
        <div key={item.id}>{item.name}</div> // ❌ ul > div
      ))}
    </ul>
  );
}
```

**해결**:
```typescript
function List() {
  return (
    <ul>
      {items.map(item => (
        <li key={item.id}>{item.name}</li> // ✅ ul > li
      ))}
    </ul>
  );
}
```

---

## 에러 3: Module Not Found

### 증상

```
Module not found: Can't resolve '@/components/Button'
```

### 해결 방법

**Step 1**: tsconfig.json 경로 확인

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./*"]
    }
  }
}
```

**Step 2**: 파일 경로 대소문자 확인

```typescript
// ❌ Wrong
import Button from '@/components/button';

// ✅ Correct
import Button from '@/components/Button';
```

**Step 3**: 파일 확장자 확인

```typescript
// Next.js는 자동으로 확장자 추론
import Button from '@/components/Button'; // .tsx, .ts, .jsx, .js 순서로 찾음
```

---

## 에러 4: ESLint 경고로 인한 빌드 실패

### 증상

```
./app/page.tsx
12:10  Warning: 'variable' is assigned a value but never used.  @typescript-eslint/no-unused-vars

info  - Need to disable some ESLint rules? Learn more here: https://nextjs.org/docs/app/api-reference/config/eslint#disabling-rules
```

### 해결 방법

**방법 1**: 미사용 변수 제거

```typescript
// Before
import { BLOG_METADATA, RSS_CONFIG } from '@/lib/constants';

export function GET() {
  // BLOG_METADATA 사용하지 않음
  return RSS_CONFIG;
}
```

```typescript
// After
import { RSS_CONFIG } from '@/lib/constants';

export function GET() {
  return RSS_CONFIG;
}
```

**방법 2**: ESLint 설정 수정 (권장하지 않음)

```javascript
// next.config.js
module.exports = {
  eslint: {
    ignoreDuringBuilds: true, // 빌드 시 ESLint 무시
  },
};
```

---

## 에러 5: Image Optimization 에러

### 증상

```
Error: Invalid src prop (https://example.com/image.jpg) on `next/image`
```

### 해결 방법

**Step 1**: next.config.js에 외부 도메인 추가

```javascript
// next.config.js
module.exports = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'example.com',
        pathname: '/**',
      },
    ],
  },
};
```

**Step 2**: 이미지 컴포넌트 사용

```typescript
import Image from 'next/image';

// ✅ Good
<Image
  src="/images/photo.jpg"
  alt="Photo"
  width={500}
  height={300}
/>

// ❌ Bad
<img src="/images/photo.jpg" alt="Photo" />
```

---

## 케이스 스터디: 실제 프로덕션 에러 해결

### 상황

모노레포 프로젝트에서 MDX 블로그 빌드 시 타입 에러 발생

### 에러 메시지

```
Type error: Type '{ mdxOptions: { rehypePlugins: [...] } }'
is not assignable to type 'SerializeOptions'
```

### 해결 과정

1. **에러 분석**: `next-mdx-remote`와 rehype 플러그인 타입 불일치 확인
2. **임시 해결**: `as any` 타입 단언으로 빌드 성공
3. **ESLint 설정**: 특정 라인에만 `eslint-disable-next-line` 추가
4. **검증**: `pnpm build` 성공 확인
5. **커밋**: 변경사항 커밋 및 푸시

### 결과

✅ 빌드 성공
✅ TypeScript 타입 체크 통과
✅ ESLint 검사 통과

---

## 고급 디버깅

### 상세 로그 활성화

```bash
# Next.js 상세 로그
DEBUG=* next build

# Webpack 로그
WEBPACK_LOG=1 next build
```

### 빌드 분석

```bash
# 번들 크기 분석
npm install @next/bundle-analyzer
```

```javascript
// next.config.js
const withBundleAnalyzer = require('@next/bundle-analyzer')({
  enabled: process.env.ANALYZE === 'true',
});

module.exports = withBundleAnalyzer({
  // ...
});
```

```bash
# 분석 실행
ANALYZE=true npm run build
```

---

## 예방 방법

### 1. CI/CD 파이프라인 구축

```yaml
# .github/workflows/build.yml
name: Build Test
on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: npm install
      - run: npm run build
```

### 2. Pre-commit Hook 설정

```bash
# .husky/pre-commit
#!/bin/sh
npm run lint
npm run type-check
```

### 3. TypeScript strict 모드

```json
{
  "compilerOptions": {
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true
  }
}
```

---

## 체크리스트

빌드 에러 발생 시 다음을 확인하세요:

- [ ] `.next` 폴더 삭제 후 재빌드
- [ ] `node_modules` 재설치
- [ ] TypeScript 버전 확인
- [ ] ESLint 규칙 확인
- [ ] 환경 변수 설정 확인
- [ ] 이미지 경로 및 도메인 설정 확인
- [ ] Hydration 이슈 확인 (date, localStorage 등)

---

## 참고 자료

- [Next.js Troubleshooting](https://nextjs.org/docs/messages)
- [Next.js GitHub Issues](https://github.com/vercel/next.js/issues)
- [Vercel Community](https://vercel.com/community)

---

**도움이 되었나요?** 다른 빌드 에러를 겪고 계신가요? 댓글로 공유해주세요!
